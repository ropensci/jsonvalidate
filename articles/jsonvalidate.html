<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to jsonvalidate • jsonvalidate</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to jsonvalidate">
<meta property="og:description" content="jsonvalidate">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">jsonvalidate</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.2.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/jsonvalidate.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ropensci/jsonvalidate/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="jsonvalidate_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to jsonvalidate</h1>
                        <h4 class="author">Rich FitzJohn</h4>
            
            <h4 class="date">2021-06-22</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/jsonvalidate/blob/master/vignettes/jsonvalidate.Rmd"><code>vignettes/jsonvalidate.Rmd</code></a></small>
      <div class="hidden name"><code>jsonvalidate.Rmd</code></div>

    </div>

    
    
<p>This package wraps <a href="https://github.com/mafintosh/is-my-json-valid">is-my-json-valid</a> using <a href="https://cran.r-project.org/package=V8">V8</a> to do JSON schema validation in R.</p>
<p>You need a JSON schema file; see <a href="http://json-schema.org">json-schema.org</a> for details on writing these. Often someone else has done the hard work of writing one for you, and you can just check that the JSON you are producing or consuming conforms to the schema.</p>
<p>The examples below come from the <a href="http://json-schema.org/learn/getting-started-step-by-step.html">JSON schema website</a></p>
<p>They describe a JSON based product catalog, where each product has an id, a name, a price, and an optional set of tags. A JSON representation of a product is:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">{</span></span>
<span id="cb1-2"><a href="#cb1-2"></a>    <span class="dt">"id"</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb1-3"><a href="#cb1-3"></a>    <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"A green door"</span><span class="fu">,</span></span>
<span id="cb1-4"><a href="#cb1-4"></a>    <span class="dt">"price"</span><span class="fu">:</span> <span class="fl">12.50</span><span class="fu">,</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>    <span class="dt">"tags"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">"home"</span><span class="ot">,</span> <span class="st">"green"</span><span class="ot">]</span></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="fu">}</span></span></code></pre></div>
<p>The schema that they derive looks like this:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb2-1"><a href="#cb2-1"></a><span class="fu">{</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>    <span class="dt">"$schema"</span><span class="fu">:</span> <span class="st">"http://json-schema.org/draft-04/schema#"</span><span class="fu">,</span></span>
<span id="cb2-3"><a href="#cb2-3"></a>    <span class="dt">"title"</span><span class="fu">:</span> <span class="st">"Product"</span><span class="fu">,</span></span>
<span id="cb2-4"><a href="#cb2-4"></a>    <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"A product from Acme's catalog"</span><span class="fu">,</span></span>
<span id="cb2-5"><a href="#cb2-5"></a>    <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"object"</span><span class="fu">,</span></span>
<span id="cb2-6"><a href="#cb2-6"></a>    <span class="dt">"properties"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb2-7"><a href="#cb2-7"></a>        <span class="dt">"id"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb2-8"><a href="#cb2-8"></a>            <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"The unique identifier for a product"</span><span class="fu">,</span></span>
<span id="cb2-9"><a href="#cb2-9"></a>            <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"integer"</span></span>
<span id="cb2-10"><a href="#cb2-10"></a>        <span class="fu">},</span></span>
<span id="cb2-11"><a href="#cb2-11"></a>        <span class="dt">"name"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb2-12"><a href="#cb2-12"></a>            <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"Name of the product"</span><span class="fu">,</span></span>
<span id="cb2-13"><a href="#cb2-13"></a>            <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"string"</span></span>
<span id="cb2-14"><a href="#cb2-14"></a>        <span class="fu">},</span></span>
<span id="cb2-15"><a href="#cb2-15"></a>        <span class="dt">"price"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb2-16"><a href="#cb2-16"></a>            <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"number"</span><span class="fu">,</span></span>
<span id="cb2-17"><a href="#cb2-17"></a>            <span class="dt">"minimum"</span><span class="fu">:</span> <span class="dv">0</span><span class="fu">,</span></span>
<span id="cb2-18"><a href="#cb2-18"></a>            <span class="dt">"exclusiveMinimum"</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb2-19"><a href="#cb2-19"></a>        <span class="fu">},</span></span>
<span id="cb2-20"><a href="#cb2-20"></a>        <span class="dt">"tags"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb2-21"><a href="#cb2-21"></a>            <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"array"</span><span class="fu">,</span></span>
<span id="cb2-22"><a href="#cb2-22"></a>            <span class="dt">"items"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb2-23"><a href="#cb2-23"></a>                <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"string"</span></span>
<span id="cb2-24"><a href="#cb2-24"></a>            <span class="fu">},</span></span>
<span id="cb2-25"><a href="#cb2-25"></a>            <span class="dt">"minItems"</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb2-26"><a href="#cb2-26"></a>            <span class="dt">"uniqueItems"</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb2-27"><a href="#cb2-27"></a>        <span class="fu">}</span></span>
<span id="cb2-28"><a href="#cb2-28"></a>    <span class="fu">},</span></span>
<span id="cb2-29"><a href="#cb2-29"></a>    <span class="dt">"required"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">"id"</span><span class="ot">,</span> <span class="st">"name"</span><span class="ot">,</span> <span class="st">"price"</span><span class="ot">]</span></span>
<span id="cb2-30"><a href="#cb2-30"></a><span class="fu">}</span></span></code></pre></div>
<p>This ensures the types of all fields, enforces presence of <code>id</code>, <code>name</code> and <code>price</code>, checks that the price is not negative and checks that if present <code>tags</code> is a unique list of strings.</p>
<p>There are two ways of passing the schema in to R; as a string or as a filename. If you have a large schema loading as a file will generally be easiest! Here’s a string representing the schema (watch out for escaping quotes):</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">schema</span> <span class="op">&lt;-</span> <span class="st">'{
    "$schema": "http://json-schema.org/draft-04/schema#",
    "title": "Product",
    "description": "A product from Acme\'s catalog",
    "type": "object",
    "properties": {
        "id": {
            "description": "The unique identifier for a product",
            "type": "integer"
        },
        "name": {
            "description": "Name of the product",
            "type": "string"
        },
        "price": {
            "type": "number",
            "minimum": 0,
            "exclusiveMinimum": true
        },
        "tags": {
            "type": "array",
            "items": {
                "type": "string"
            },
            "minItems": 1,
            "uniqueItems": true
        }
    },
    "required": ["id", "name", "price"]
}'</span></code></pre></div>
<p>Create a validator:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">v</span> <span class="op">&lt;-</span> <span class="fu">jsonvalidate</span><span class="fu">::</span><span class="fu"><a href="../reference/json_validator.html">json_validator</a></span><span class="op">(</span><span class="va">schema</span><span class="op">)</span></code></pre></div>
<p>If we’d saved the json to a file, this would work too:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/writeLines.html">writeLines</a></span><span class="op">(</span><span class="va">schema</span>, <span class="va">path</span><span class="op">)</span>
<span class="va">v</span> <span class="op">&lt;-</span> <span class="fu">jsonvalidate</span><span class="fu">::</span><span class="fu"><a href="../reference/json_validator.html">json_validator</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span></code></pre></div>
<p>The returned object is a function that takes as its first argument a json string, or a filename of a json file. The empty list will fail validation because it does not contain any of the required fields:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">v</span><span class="op">(</span><span class="st">"{}"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p>To get more information on why the validation fails, add <code>verbose = TRUE</code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">v</span><span class="op">(</span><span class="st">"{}"</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] FALSE
## attr(,"errors")
##        field     message
## 1    data.id is required
## 2  data.name is required
## 3 data.price is required</code></pre>
<p>The attribute “errors” is a data.frame and is present only when the json fails validation. The error messages come straight from <code>is-my-json-valid</code> and they may not always be that informative.</p>
<p>Alternatively, to throw an error if the json does not validate, add <code>error = TRUE</code> to the call:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">v</span><span class="op">(</span><span class="st">"{}"</span>, error <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## Error: 3 errors validating json:
##  - data.id: is required
##  - data.name: is required
##  - data.price: is required</code></pre>
<p>And to continue validating after the first error, pass <code>greedy = TRUE</code>:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">v</span><span class="op">(</span><span class="st">"{}"</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span>, greedy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] FALSE
## attr(,"errors")
##        field     message
## 1    data.id is required
## 2  data.name is required
## 3 data.price is required</code></pre>
<p>which will sometimes show more errors.</p>
<p>The JSON from the opening example works:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">v</span><span class="op">(</span><span class="st">'{
    "id": 1,
    "name": "A green door",
    "price": 12.50,
    "tags": ["home", "green"]
}'</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>But if we tried to enter a negative price it would fail:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">v</span><span class="op">(</span><span class="st">'{
    "id": 1,
    "name": "A green door",
    "price": -1,
    "tags": ["home", "green"]
}'</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] FALSE
## attr(,"errors")
##        field              message
## 1 data.price is less than minimum</code></pre>
<p>…or duplicate tags:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">v</span><span class="op">(</span><span class="st">'{
    "id": 1,
    "name": "A green door",
    "price": 12.50,
    "tags": ["home", "home"]
}'</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] FALSE
## attr(,"errors")
##       field        message
## 1 data.tags must be unique</code></pre>
<p>or just basically everything wrong:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">v</span><span class="op">(</span><span class="st">'{
    "id": "identifier",
    "name": 1,
    "price": -1,
    "tags": ["home", "home", 1]
}'</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] FALSE
## attr(,"errors")
##         field              message
## 1     data.id    is the wrong type
## 2   data.name    is the wrong type
## 3  data.price is less than minimum
## 4   data.tags       must be unique
## 5 data.tags.2    is the wrong type</code></pre>
<p>The <code>data.tags.2</code> name comes from within the <code>is-my-json-valid</code> source, and may be annoying to work with programmatically.</p>
<p>There is also a simple interface where you take the schema and the json at the same time:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">json</span> <span class="op">&lt;-</span> <span class="st">'{
    "id": 1,
    "name": "A green door",
    "price": 12.50,
    "tags": ["home", "green"]
}'</span>
<span class="fu">jsonvalidate</span><span class="fu">::</span><span class="fu"><a href="../reference/json_validate.html">json_validate</a></span><span class="op">(</span><span class="va">json</span>, <span class="va">schema</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Rich FitzJohn.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
